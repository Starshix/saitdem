{% extends 'portal/base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card p-4">
            <h2 class="text-center mb-4">–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ</h2>
            
            <form method="post" id="application-form">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="{{ form.course.id_for_label }}" class="form-label">
                        {{ form.course.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.course }}
                </div>
                
                <div class="mb-3">
                    <label for="{{ form.desired_start_date.id_for_label }}" class="form-label">
                        {{ form.desired_start_date.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.desired_start_date }}
                </div>
                
                <div class="mb-3">
                    <label for="{{ form.payment_method.id_for_label }}" class="form-label">
                        {{ form.payment_method.label }} <span class="text-danger">*</span>
                    </label>
                    {{ form.payment_method }}
                </div>
                
                <div id="course-description" class="alert alert-info" style="display: none;">
                    <h5>–û–ø–∏—Å–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–∞:</h5>
                    <p id="description-text"></p>
                </div>
                
                <div class="alert alert-info">
                    <small>
                        –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏ –æ–Ω–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. 
                        –í—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Å–≤–æ–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.
                    </small>
                </div>
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success btn-lg">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                    <a href="{% url 'profile' %}" class="btn btn-outline-secondary">
                        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card p-4">
            <h4>üìö –í—Å–µ –∫—É—Ä—Å—ã:</h4>
            <div class="list-group">
                {% for course in form.course.field.queryset %}
                <a href="#" class="list-group-item list-group-item-action course-preview" 
                   data-course-id="{{ course.id }}"
                   data-description="{{ course.description }}">
                    <h6 class="mb-1">{{ course.title }}</h6>
                    <small class="text-muted">
                        {% if course.description|length > 80 %}
                            {{ course.description|slice:":80" }}...
                        {% else %}
                            {{ course.description }}
                        {% endif %}
                    </small>
                </a>
                {% empty %}
                <div class="alert alert-warning">
                    –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç.
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>

const coursesData = {
    {% for course in form.course.field.queryset %}
    {{ course.id }}: {
        title: "{{ course.title|escapejs }}",
        description: `{{ course.description|escapejs }}`
    },
    {% endfor %}
};

function showCourseDescription() {
    const select = document.getElementById('course-select');
    const descriptionDiv = document.getElementById('course-description');
    const descriptionText = document.getElementById('description-text');
    
    if (select.value) {
        const courseId = select.value;
        const course = coursesData[courseId];
        
        if (course) {
            descriptionText.textContent = course.description;
            descriptionDiv.style.display = 'block';
        }
    } else {
        descriptionDiv.style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    showCourseDescription();
    
    document.querySelectorAll('.course-preview').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const courseId = this.getAttribute('data-course-id');
            const description = this.getAttribute('data-description');
            
            const select = document.getElementById('course-select');
            select.value = courseId;
            
            const descriptionDiv = document.getElementById('course-description');
            const descriptionText = document.getElementById('description-text');
            descriptionText.textContent = description;
            descriptionDiv.style.display = 'block';
            
            document.getElementById('application-form').scrollIntoView({behavior: 'smooth'});
        });
    });
});
</script>
{% endblock %}